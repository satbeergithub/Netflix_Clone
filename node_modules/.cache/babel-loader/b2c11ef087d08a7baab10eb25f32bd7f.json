{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar Deferred = /** @class */function () {\n  function Deferred() {\n    var _this = this;\n    this.promise = new Promise(function (resolve, reject) {\n      _this.resolve = resolve;\n      _this.reject = reject;\n    });\n  }\n  /**\n   * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\n   * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\n   * and returns a node-style callback which will resolve or reject the Deferred's promise.\n   * @param {((?function(?(Error)): (?|undefined))| (?function(?(Error),?=): (?|undefined)))=} callback\n   * @return {!function(?(Error), ?=)}\n   */\n  Deferred.prototype.wrapCallback = function (callback) {\n    var _this = this;\n    return function (error, value) {\n      if (error) {\n        _this.reject(error);\n      } else {\n        _this.resolve(value);\n      }\n      if (typeof callback === 'function') {\n        // Attaching noop handler just in case developer wasn't expecting\n        // promises\n        _this.promise.catch(function () {});\n        // Some of our callbacks don't expect a value and our own tests\n        // assert that the parameter length is 1\n        if (callback.length === 1) {\n          callback(error);\n        } else {\n          callback(error, value);\n        }\n      }\n    };\n  };\n  return Deferred;\n}();\nexports.Deferred = Deferred;","map":{"version":3,"mappings":";;AAAA;;;;;;;;;;;;;;;;;;AAgBA;EAIE;IAAA;IACE,IAAI,CAACA,OAAO,GAAG,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM;MACzCC,KAAI,CAACF,OAAO,GAAGA,OAAO;MACtBE,KAAI,CAACD,MAAM,GAAGA,MAAM;IACtB,CAAC,CAAC;EACJ;EAEA;;;;;;;EAOAE,+BAAY,GAAZ,UAAaC,QAAS;IAAtB;IACE,OAAO,UAACC,KAAK,EAAEC,KAAM;MACnB,IAAID,KAAK,EAAE;QACTH,KAAI,CAACD,MAAM,CAACI,KAAK,CAAC;MACpB,CAAC,MAAM;QACLH,KAAI,CAACF,OAAO,CAACM,KAAK,CAAC;MACrB;MACA,IAAI,OAAOF,QAAQ,KAAK,UAAU,EAAE;QAClC;QACA;QACAF,KAAI,CAACJ,OAAO,CAACS,KAAK,CAAC,aAAO,CAAC,CAAC;QAE5B;QACA;QACA,IAAIH,QAAQ,CAACI,MAAM,KAAK,CAAC,EAAE;UACzBJ,QAAQ,CAACC,KAAK,CAAC;QACjB,CAAC,MAAM;UACLD,QAAQ,CAACC,KAAK,EAAEC,KAAK,CAAC;QACxB;MACF;IACF,CAAC;EACH,CAAC;EACH,eAAC;AAAD,CAxCA,EAwCC;AAxCYG","names":["promise","Promise","resolve","reject","_this","Deferred","callback","error","value","catch","length","exports"],"sources":["../src/deferred.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class Deferred<R> {\n  promise: Promise<R>;\n  reject;\n  resolve;\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.resolve = resolve;\n      this.reject = reject;\n    });\n  }\n\n  /**\n   * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\n   * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\n   * and returns a node-style callback which will resolve or reject the Deferred's promise.\n   * @param {((?function(?(Error)): (?|undefined))| (?function(?(Error),?=): (?|undefined)))=} callback\n   * @return {!function(?(Error), ?=)}\n   */\n  wrapCallback(callback?) {\n    return (error, value?) => {\n      if (error) {\n        this.reject(error);\n      } else {\n        this.resolve(value);\n      }\n      if (typeof callback === 'function') {\n        // Attaching noop handler just in case developer wasn't expecting\n        // promises\n        this.promise.catch(() => {});\n\n        // Some of our callbacks don't expect a value and our own tests\n        // assert that the parameter length is 1\n        if (callback.length === 1) {\n          callback(error);\n        } else {\n          callback(error, value);\n        }\n      }\n    };\n  }\n}\n"]},"metadata":{},"sourceType":"script"}