{"ast":null,"code":"/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as object from './object';\nimport * as constants from './constants';\n/**\n * @struct\n */\nvar RequestMap = /** @class */function () {\n  function RequestMap() {\n    this.map_ = {};\n    this.id_ = constants.minSafeInteger;\n  }\n  /**\n   * Registers the given request with this map.\n   * The request is unregistered when it completes.\n   * @param r The request to register.\n   */\n  RequestMap.prototype.addRequest = function (r) {\n    var id = this.id_;\n    this.id_++;\n    this.map_[id] = r;\n    var self = this;\n    function unmap() {\n      delete self.map_[id];\n    }\n    r.getPromise().then(unmap, unmap);\n  };\n  /**\n   * Cancels all registered requests.\n   */\n  RequestMap.prototype.clear = function () {\n    object.forEach(this.map_, function (key, val) {\n      if (val) {\n        val.cancel(true);\n      }\n    });\n    this.map_ = {};\n  };\n  return RequestMap;\n}();\nexport { RequestMap };","map":{"version":3,"mappings":"AAAA;;;;;;;;;;;;;;;AAeA,OAAO,KAAKA,MAAM,MAAM,UAAU;AAGlC,OAAO,KAAKC,SAAS,MAAM,aAAa;AAExC;;;AAGA;EAIE;IAHQ,SAAI,GAAoC,EAAE;IAIhD,IAAI,CAACC,GAAG,GAAGD,SAAS,CAACE,cAAc;EACrC;EAEA;;;;;EAKAC,+BAAU,GAAV,UAAWC,CAAe;IACxB,IAAIC,EAAE,GAAG,IAAI,CAACJ,GAAG;IACjB,IAAI,CAACA,GAAG,EAAE;IACV,IAAI,CAACK,IAAI,CAACD,EAAE,CAAC,GAAGD,CAAC;IACjB,IAAIG,IAAI,GAAG,IAAI;IAEf;MACE,OAAOA,IAAI,CAACD,IAAI,CAACD,EAAE,CAAC;IACtB;IACAD,CAAC,CAACI,UAAU,EAAE,CAACC,IAAI,CAACC,KAAK,EAAEA,KAAK,CAAC;EACnC,CAAC;EAED;;;EAGAP,0BAAK,GAAL;IACEJ,MAAM,CAACY,OAAO,CAAC,IAAI,CAACL,IAAI,EAAE,UAACM,GAAW,EAAEC,GAAiB;MACvD,IAAIA,GAAG,EAAE;QACPA,GAAG,CAACC,MAAM,CAAC,IAAI,CAAC;MAClB;IACF,CAAC,CAAC;IACF,IAAI,CAACR,IAAI,GAAG,EAAE;EAChB,CAAC;EACH,iBAAC;AAAD,CApCA,EAoCC","names":["object","constants","id_","minSafeInteger","RequestMap","r","id","map_","self","getPromise","then","unmap","forEach","key","val","cancel"],"sources":["../src/implementation/requestmap.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as object from './object';\nimport * as RequestExports from './request';\nimport { Request } from './request';\nimport * as constants from './constants';\n\n/**\n * @struct\n */\nexport class RequestMap {\n  private map_: { [key: number]: Request<any> } = {};\n  private id_: number;\n\n  constructor() {\n    this.id_ = constants.minSafeInteger;\n  }\n\n  /**\n   * Registers the given request with this map.\n   * The request is unregistered when it completes.\n   * @param r The request to register.\n   */\n  addRequest(r: Request<any>) {\n    let id = this.id_;\n    this.id_++;\n    this.map_[id] = r;\n    let self = this;\n\n    function unmap() {\n      delete self.map_[id];\n    }\n    r.getPromise().then(unmap, unmap);\n  }\n\n  /**\n   * Cancels all registered requests.\n   */\n  clear() {\n    object.forEach(this.map_, (key: string, val: Request<any>) => {\n      if (val) {\n        val.cancel(true);\n      }\n    });\n    this.map_ = {};\n  }\n}\n"]},"metadata":{},"sourceType":"module"}